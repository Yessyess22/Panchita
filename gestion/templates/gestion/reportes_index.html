{% extends 'gestion/base.html' %}
{% load static %}

{% block extra_css %}
<style>
    .reportes-container { max-width: 1200px; margin: 0 auto; padding: 2rem; }
    .reportes-header { margin-bottom: 2rem; }
    .reportes-header h1 { color: var(--panchita-dark); font-size: 2rem; margin: 0; }
    .filters-bar { background: white; border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .filters-bar form { display: flex; gap: 1rem; flex-wrap: wrap; align-items: end; }
    .filter-group { flex: 1; min-width: 150px; }
    .filter-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; font-size: 0.9rem; }
    .filter-group input { width: 100%; padding: 0.5rem; border: 2px solid #ddd; border-radius: 8px; }
    .btn-filter { background: var(--panchita-red); color: white; border: none; padding: 0.6rem 1.2rem; border-radius: 8px; font-weight: 600; cursor: pointer; }
    .resumen-card { background: linear-gradient(135deg, var(--panchita-red) 0%, var(--panchita-red-dark) 100%); border-radius: 15px; padding: 2rem; color: white; margin-bottom: 2rem; text-align: center; border-bottom: 4px solid var(--panchita-yellow); }
    .resumen-card .total { font-size: 2.5rem; font-weight: 700; color: var(--panchita-yellow); }
    .resumen-card .label { font-size: 1rem; opacity: 0.95; }
    .reporte-card { background: white; border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    .reporte-card h3 { color: var(--panchita-dark); margin: 0 0 1rem 0; font-size: 1.2rem; padding-bottom: 0.5rem; border-bottom: 2px solid var(--panchita-red); }
    .reporte-table { width: 100%; border-collapse: collapse; }
    .reporte-table th, .reporte-table td { padding: 0.75rem; text-align: left; border-bottom: 1px solid #eee; }
    .reporte-table th { background: #f8f9fa; font-weight: 600; color: var(--panchita-dark); }
    .reporte-table .text-right { text-align: right; }
    .empty-row { text-align: center; padding: 2rem; color: #999; }
</style>
{% endblock %}

{% block content %}
<div class="reportes-container">
    <div class="reportes-header">
        <h1><i class="fas fa-chart-bar"></i> Reportes</h1>
        <p style="color: #666; margin-top: 0.5rem;">Ventas por período, productos más vendidos y total por método de pago</p>
    </div>

    <div class="filters-bar">
        <form method="get">
            <div class="filter-group">
                <label for="fecha_inicio">Desde</label>
                <input type="date" name="fecha_inicio" id="fecha_inicio" value="{{ fecha_inicio }}">
            </div>
            <div class="filter-group">
                <label for="fecha_fin">Hasta</label>
                <input type="date" name="fecha_fin" id="fecha_fin" value="{{ fecha_fin }}">
            </div>
            <button type="submit" class="btn-filter"><i class="fas fa-filter"></i> Aplicar</button>
        </form>
    </div>

    <div class="resumen-card">
        <div class="label">Total del período ({{ num_ventas_periodo }} ventas)</div>
        <div class="total">Bs. {{ total_periodo|floatformat:2 }}</div>
    </div>

    <div class="reporte-card">
        <h3><i class="fas fa-trophy"></i> Productos más vendidos</h3>
        <table class="reporte-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Producto</th>
                    <th class="text-right">Cantidad</th>
                    <th class="text-right">Total Bs.</th>
                </tr>
            </thead>
            <tbody>
                {% for item in productos_mas_vendidos %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ item.producto__nombre }}</td>
                    <td class="text-right">{{ item.cantidad }}</td>
                    <td class="text-right">Bs. {{ item.total|floatformat:2 }}</td>
                </tr>
                {% empty %}
                <tr><td colspan="4" class="empty-row">No hay ventas en el período</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="reporte-card">
        <h3><i class="fas fa-wallet"></i> Total por método de pago</h3>
        <table class="reporte-table">
            <thead>
                <tr>
                    <th>Método</th>
                    <th class="text-right">Total Bs.</th>
                </tr>
            </thead>
            <tbody>
                {% for item in pagos_periodo %}
                <tr>
                    <td>{{ item.metodo_pago__nombre }}</td>
                    <td class="text-right">Bs. {{ item.total|floatformat:2 }}</td>
                </tr>
                {% empty %}
                <tr><td colspan="2" class="empty-row">No hay pagos en el período</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
