<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pollos Panchita - Sistema</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'gestion/css/base.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    {% block extra_css %}{% endblock %}
</head>

<body>
    <aside class="sidebar">
        <a href="{% url 'index' %}" class="sidebar-brand">
            <i class="fas fa-drumstick-bite"></i>
            <span>Pollos Panchita</span>
        </a>

        <nav class="sidebar-nav">
            <a href="{% url 'index' %}" class="sidebar-link {% if active == 'home' %}active{% endif %}" title="Inicio">
                <i class="fas fa-home"></i>
                <span>Inicio</span>
            </a>
            <a href="{% url 'pos' %}" class="sidebar-link {% if active == 'pos' %}active{% endif %}" title="Punto de Venta">
                <i class="fas fa-cash-register"></i>
                <span>Punto de Venta</span>
            </a>
            <a href="{% url 'venta_index' %}" class="sidebar-link {% if active == 'ventas' %}active{% endif %}" title="Ventas">
                <i class="fas fa-list-alt"></i>
                <span>Ventas</span>
            </a>
            <a href="{% url 'cliente_index' %}" class="sidebar-link {% if active == 'clientes' %}active{% endif %}" title="Clientes">
                <i class="fas fa-users"></i>
                <span>Clientes</span>
            </a>
            <a href="{% url 'cierre_caja_index' %}" class="sidebar-link {% if active == 'cierre_caja' %}active{% endif %}" title="Cierre de Caja">
                <i class="fas fa-lock"></i>
                <span>Cierre de Caja</span>
            </a>
            {% if user.is_staff %}
            <div class="sidebar-divider"></div>
            <a href="{% url 'producto_index' %}" class="sidebar-link {% if active == 'productos' %}active{% endif %}" title="Productos">
                <i class="fas fa-boxes"></i>
                <span>Productos</span>
            </a>
            <a href="{% url 'categoria_index' %}" class="sidebar-link {% if active == 'categorias' %}active{% endif %}" title="Categorías">
                <i class="fas fa-tags"></i>
                <span>Categorías</span>
            </a>
            <a href="{% url 'metodopago_index' %}" class="sidebar-link {% if active == 'metodos_pago' %}active{% endif %}" title="Métodos de Pago">
                <i class="fas fa-credit-card"></i>
                <span>Métodos de Pago</span>
            </a>
            <a href="{% url 'promocion_index' %}" class="sidebar-link {% if active == 'promociones' %}active{% endif %}" title="Promociones">
                <i class="fas fa-tags"></i>
                <span>Promociones</span>
            </a>
            <a href="{% url 'reportes_index' %}" class="sidebar-link {% if active == 'reportes' %}active{% endif %}" title="Reportes">
                <i class="fas fa-chart-bar"></i>
                <span>Reportes</span>
            </a>
            {% endif %}
        </nav>

        <div class="sidebar-footer">
            {% if user.is_staff %}
            <a href="{% url 'admin_index' %}" class="sidebar-link {% if active == 'admin' %}active{% endif %}" title="Admin">
                <i class="fas fa-cog"></i>
                <span>Admin</span>
            </a>
            {% endif %}
            <a href="{% url 'logout' %}" class="sidebar-link sidebar-logout" title="Cerrar sesión">
                <i class="fas fa-sign-out-alt"></i>
                <span>Salir</span>
            </a>
        </div>
    </aside>

    <main class="main-content">
        {% block content %}{% endblock %}
    </main>

    {% block messages_display %}
    {% if messages %}
    <div id="alert-modal-overlay" class="alert-modal-overlay" role="dialog" aria-modal="true" aria-labelledby="alert-modal-title">
        {% for message in messages %}
        {% if forloop.first %}
        <div class="alert-modal-box alert-modal-{{ message.tags|default:'info' }}">
            <div class="alert-modal-icon">
                <i class="fas fa-{% if message.tags == 'error' or message.tags == 'danger' %}exclamation-circle{% elif message.tags == 'success' %}check-circle{% elif message.tags == 'warning' %}exclamation-triangle{% else %}info-circle{% endif %}"></i>
            </div>
            <h3 id="alert-modal-title" class="alert-modal-title">
                {% if message.tags == 'error' or message.tags == 'danger' %}Error de validación
                {% elif message.tags == 'success' %}Correcto
                {% elif message.tags == 'warning' %}Atención
                {% else %}Mensaje{% endif %}
            </h3>
            <div class="alert-modal-messages">
        {% endif %}
                <p class="alert-modal-text">{{ message }}</p>
        {% if forloop.last %}
            </div>
            <button type="button" class="alert-modal-btn" id="alert-modal-aceptar" autofocus>Aceptar</button>
        </div>
        {% endif %}
        {% endfor %}
    </div>
    <script>
        (function() {
            var overlay = document.getElementById('alert-modal-overlay');
            var btn = document.getElementById('alert-modal-aceptar');
            if (overlay && btn) {
                btn.addEventListener('click', function() {
                    overlay.classList.add('alert-modal-hidden');
                    setTimeout(function() { overlay.remove(); }, 300);
                });
                overlay.addEventListener('click', function(e) {
                    if (e.target === overlay) {
                        overlay.classList.add('alert-modal-hidden');
                        setTimeout(function() { overlay.remove(); }, 300);
                    }
                });
            }
        })();
    </script>
    {% endif %}
    {% endblock %}

    <script>
    // Modal de alerta reutilizable (misma UX que mensajes Django) para validaciones y errores en JS
    window.showAlertModal = function(text, type) {
        type = type || 'info';
        var titles = { error: 'Error de validación', success: 'Correcto', warning: 'Atención', info: 'Mensaje' };
        var icons = { error: 'exclamation-circle', success: 'check-circle', warning: 'exclamation-triangle', info: 'info-circle' };
        if (type === 'danger') type = 'error';
        var overlay = document.createElement('div');
        overlay.id = 'alert-modal-js-overlay';
        overlay.className = 'alert-modal-overlay';
        overlay.setAttribute('role', 'dialog');
        overlay.setAttribute('aria-modal', 'true');
        overlay.setAttribute('aria-labelledby', 'alert-modal-js-title');
        overlay.innerHTML = '<div class="alert-modal-box alert-modal-' + type + '">' +
            '<div class="alert-modal-icon"><i class="fas fa-' + (icons[type] || icons.info) + '"></i></div>' +
            '<h3 id="alert-modal-js-title" class="alert-modal-title">' + (titles[type] || titles.info) + '</h3>' +
            '<div class="alert-modal-messages"><p class="alert-modal-text">' + (text || '').replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</p></div>' +
            '<button type="button" class="alert-modal-btn" id="alert-modal-js-aceptar" autofocus>Aceptar</button></div>';
        document.body.appendChild(overlay);
        var btn = document.getElementById('alert-modal-js-aceptar');
        function close() {
            overlay.classList.add('alert-modal-hidden');
            setTimeout(function() { if (overlay.parentNode) overlay.parentNode.removeChild(overlay); }, 300);
        }
        if (btn) btn.addEventListener('click', close);
        overlay.addEventListener('click', function(e) {
            if (e.target === overlay) close();
        });
    };
    </script>
    {% block scripts %}{% endblock %}
</body>

</html>